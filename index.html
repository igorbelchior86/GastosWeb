
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<title>Controle 365</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#f2f4f7;--panel:#fff;--panel-alt:#f7f9fc;--accent:#0066ff;--accent-hover:#0056d4;--danger:#d92d20;--text:#111827;--text-muted:#6b7280;--border:#d1d5db;--radius:8px}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:var(--bg);color:var(--text);padding:20px;display:flex;justify-content:center;font-size:15px}
.wrapper{width:100%;max-width:960px}
.container{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin-bottom:18px}
h2{font-size:1.2rem;font-weight:600;margin-bottom:12px}

/* ... (same CSS as previous, omitted for brevity) ... */

/* we keep prior styles but trimmed */
table{width:100%;border-collapse:collapse;font-size:.82rem;margin-top:10px}
thead th{background:var(--panel-alt);padding:6px;font-weight:600;text-align:left}
th,td{border:1px solid var(--border);padding:6px;vertical-align:top;word-wrap:anywhere}
tr.month-header{background:var(--panel-alt);cursor:pointer}
tr.month-header.closed{background:#e9ecf3}
td.saldo-neg{background:#fdeaea}
@media(max-width:480px){
  th:nth-child(3),td:nth-child(3){display:none}
  th:nth-child(1),td:nth-child(1){width:68px}th:nth-child(4),td:nth-child(4){width:88px}
  .op-line{flex-direction:column;align-items:flex-start;gap:2px}
  .op-line span{display:block;font-size:.8rem}
}
.op-line{display:flex;align-items:center;justify-content:space-between;gap:6px}
.op-txt{display:flex;gap:6px;flex:1}
button.icon{background:none;border:none;font-size:1rem;color:var(--text-muted);padding:0 2px;cursor:pointer}
button.icon:hover{color:var(--accent-hover)}button.icon.danger:hover{color:var(--danger)}
</style>
</head>
<body>
<div class="wrapper">
  <div class="container">
    <h2>Lançar operação</h2>
    <div class="form-grid">
      <input id="desc" placeholder="Descrição">
      <input id="value" type="number" placeholder="Valor (- despesa)">
      <select id="method"></select>
      <input id="opDate" type="date">
      <button id="addBtn">Adicionar</button>
    </div>
  </div>

  <!-- Gerenciar cartões -->
  <div class="container"><details><summary>Gerenciar cartões</summary>
    <div style="margin-top:10px">
      <div class="form-grid" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));margin-bottom:6px">
        <input id="cardName" placeholder="Nome">
        <input id="cardClose" type="number" min="1" max="31" placeholder="Fech">
        <input id="cardDue" type="number" min="1" max="31" placeholder="Venc">
        <button id="addCardBtn">Adicionar</button>
      </div>
      <ul id="cardList" style="margin-top:8px"></ul>
    </div></details>
  </div>

  <!-- Tabela -->
  <div class="container">
    <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px" id="startGroup">
      <label for="startInput">Saldo inicial:</label>
      <input id="startInput" type="number" style="flex:1">
      <button id="setStartBtn" style="flex:0 0 60px">OK</button>
    </div>
    <div class="table-wrapper">
      <table id="dailyTable"><thead><tr><th>Data</th><th>Descrição</th><th>Gasto</th><th>Saldo</th></tr></thead><tbody></tbody></table>
    </div>
    <button id="resetData" class="danger" style="margin-top:12px">Limpar TODOS</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

const firebaseConfig={apiKey:"AIzaSyATGZtBlnSPnFtVgTqJ_E0xmBgzLTmMkI0",authDomain:"gastosweb-e7356.firebaseapp.com",databaseURL:"https://gastosweb-e7356-default-rtdb.firebaseio.com",projectId:"gastosweb-e7356",storageBucket:"gastosweb-e7356.firebasestorage.app",messagingSenderId:"519966772782",appId:"1:519966772782:web:9ec19e944e23dbe9e899bf"};
const app=initializeApp(firebaseConfig);const db=getDatabase(app);const PATH='orcamento365_9b8e04c5';
const save=(k,v)=>set(ref(db,`${PATH}/${k}`),v);const load=async(k,d)=>{const s=await get(ref(db,`${PATH}/${k}`));return s.exists()?s.val():d;};

let transactions=[],cards=[],startBalance=null;
const $=id=>document.getElementById(id);
const tbody=document.querySelector('#dailyTable tbody');

const currency=v=>v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const meses=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
const mobile=()=>window.innerWidth<=480;
const fmt=d=>d.toLocaleDateString('pt-BR',mobile()?{day:'2-digit',month:'2-digit'}:{day:'2-digit',month:'2-digit',year:'numeric'});

function renderTable(){
  tbody.innerHTML='';
  const year=new Date().getFullYear();const curMonth=new Date().getMonth();let saldo=startBalance||0;
  for(let m=0;m<12;m++){
    const head=document.createElement('tr');head.className='month-header';head.dataset.m=m;
    const td=document.createElement('td');td.colSpan=4;td.textContent=meses[m];head.appendChild(td);
    if(m<curMonth){head.classList.add('closed');}
    head.onclick=()=>{const hide=head.classList.toggle('closed');document.querySelectorAll(`tr[data-mon='${m}']`).forEach(r=>r.style.display=hide?'none':'table-row');};
    tbody.appendChild(head);
    for(let d=1;d<=31;d++){
      const date=new Date(year,m,d);if(date.getMonth()!==m)break;
      const iso=date.toISOString().slice(0,10);
      const dayTx=transactions.filter(t=>t.postDate===iso);
      const sum=dayTx.reduce((s,t)=>s+t.val,0);
      saldo+=sum;
      const row=document.createElement('tr');row.dataset.mon=m;row.style.display=m<curMonth?'none':'table-row';
      row.innerHTML=`<td>${fmt(date)}</td><td>${dayTx.map(t=>t.desc).join(', ')}</td><td>${sum?currency(sum):''}</td><td${saldo<0?' class="saldo-neg"':''}>${currency(saldo)}</td>`;
      tbody.appendChild(row);
    }
  }
}
(async()=>{
  transactions=await load('tx',[]);cards=await load('cards',[{name:'dinheiro',close:0,due:0}]);startBalance=await load('startBal',null);
  renderTable();
})();
</script>
</body>
</html>
