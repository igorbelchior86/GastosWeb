
<!DOCTYPE html><html lang="pt-BR"><head><meta charset="utf-8"><title>Controle 365</title><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"><style>:root{--b:#f2f4f7;--p:#fff;--a:#0066ff;--ah:#0056d4;--d:#d92d20;--t:#111827;--m:#6b7280;--br:#d1d5db;--r:8px}*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}body{background:var(--b);color:var(--t);padding:20px;display:flex;justify-content:center;font-size:15px}.w{width:100%;max-width:960px}.c{background:var(--p);border:1px solid var(--br);border-radius:var(--r);padding:18px;margin-bottom:18px}.c h2{font-size:1.3rem;font-weight:600;margin-bottom:14px}.g{display:grid;gap:10px;grid-template-columns:2fr 1fr;grid-template-areas:'d v''m dt''. b'}#desc{grid-area:d}#val{grid-area:v}#met{grid-area:m}#date{grid-area:dt}#add{grid-area:b;width:100%;padding:12px;border:none;border-radius:var(--r);background:var(--a);color:#fff;font-weight:600;cursor:pointer}#add:hover{background:var(--ah)}.g input,.g select{padding:10px;border:1px solid var(--br);border-radius:var(--r);font-size:.9rem;width:100%}.g input[type=date]{appearance:none;-webkit-appearance:none}.tw{overflow-x:auto}table{width:100%;border-collapse:collapse;font-size:.82rem;margin-top:10px}th,td{border:1px solid var(--br);padding:6px}thead th{background:#f7f9fc}tr.mh{background:#f7f9fc;cursor:pointer}.mh.closed{background:#e9ecf3}.neg{color:#b42318;font-weight:600}.pos{color:#027a48;font-weight:600}.balneg{background:#fdeaea}.ol{display:flex;justify-content:space-between;align-items:center;gap:6px}.ot{display:flex;gap:6px;flex:1}.icon{background:none;border:none;font-size:1rem;color:var(--m);padding:0 2px;cursor:pointer}.icon:hover{color:var(--ah)}.icon.d:hover{color:var(--d)}details.invoice summary{cursor:pointer;list-style:none}details.invoice summary::before{content:'‚ñ∏';margin-right:4px}details.invoice[open] summary::before{transform:rotate(90deg)}.invoice{background:#f7f9fc;padding:6px;border-radius:var(--r);margin-bottom:4px}small{color:var(--m);font-size:.75rem}@media(max-width:480px){.c{padding:14px}.g{grid-template-columns:1fr;grid-template-areas:'d''v''m''dt''b'}th:nth-child(3),td:nth-child(3){display:none}th:nth-child(1),td:nth-child(1){width:68px}th:nth-child(4),td:nth-child(4){width:88px}.ol{align-items:flex-start}.ot{flex-direction:column}.ot .v{font-size:.8rem}}</style></head><body><div class="w"><div class="c"><h2>Lan√ßar opera√ß√£o</h2><div class="g"><input id="desc" placeholder="Descri√ß√£o"><input id="val" type="number" placeholder="Valor (- despesa)"><select id="met"><option>dinheiro</option></select><input id="date" type="date"><button id="add">Adicionar</button></div></div><div class="c"><details><summary>Gerenciar cart√µes</summary><div style="margin-top:10px"><div class="g" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;margin-bottom:6px"><input id="cName" placeholder="Nome"><input id="cClose" type="number" min="1" max="31" placeholder="Fech"><input id="cDue" type="number" min="1" max="31" placeholder="Venc"><button id="cAdd">Adicionar</button></div><ul id="cList"></ul></div></details></div><div class="c"><div style="display:flex;gap:10px;align-items:center;margin-bottom:8px" id="sGroup"><label for="sInput">Saldo inicial:</label><input id="sInput" type="number" style="flex:1"><button id="sOk" style="flex:0 0 60px">OK</button></div><div class="tw"><table id="tbl"><thead><tr><th>Data</th><th>Descri√ß√£o</th><th>Gasto</th><th>Saldo</th></tr></thead><tbody></tbody></table></div><button id="reset" class="danger" style="margin-top:12px;background:var(--d);color:#fff">Limpar TODOS</button></div></div><script type="module">import{initializeApp}from"https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";import{getDatabase,ref,set,get}from"https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";const cfg={apiKey:"AIzaSyATGZtBlnSPnFtVgTqJ_E0xmBgzLTmMkI0",authDomain:"gastosweb-e7356.firebaseapp.com",databaseURL:"https://gastosweb-e7356-default-rtdb.firebaseio.com",projectId:"gastosweb-e7356",storageBucket:"gastosweb-e7356.firebasestorage.app",messagingSenderId:"519966772782",appId:"1:519966772782:web:9ec19e944e23dbe9e899bf"};const app=initializeApp(cfg),db=getDatabase(app),PATH='orcamento365';const save=(k,v)=>set(ref(db,`${PATH}/${k}`),v),load=async(k,d)=>{const s=await get(ref(db,`${PATH}/${k}`));return s.exists()?s.val():d};let cards=[{name:'dinheiro',close:0,due:0}],tx=[],start=null;const $=i=>document.getElementById(i),tb=document.querySelector('#tbl tbody'),mes=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],curr=v=>v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}),mobi=()=>innerWidth<=480,fmt=d=>d.toLocaleDateString('pt-BR',mobi()?{day:'2-digit',month:'2-digit'}:{day:'2-digit',month:'2-digit',year:'numeric'}),pd=(iso,m)=>{if(m==='dinheiro')return iso;const c=cards.find(x=>x.name===m);if(!c)return iso;let[y,mo,d]=iso.split('-').map(Number),mm=mo,yy=y;if(d>c.close){mm++;if(mm===13){mm=1;yy++;}}return yy+'-'+String(mm).padStart(2,'0')+'-'+String(c.due).padStart(2,'0')};function refreshMet(){const met=$('met');met.innerHTML='';cards.forEach(c=>met.insertAdjacentHTML('beforeend',`<option>${c.name}</option>`))}function listCards(){const ul=$('cList');ul.innerHTML='';cards.slice(1).forEach(c=>{const li=document.createElement('li');li.textContent=`${c.name} (${c.close}/${c.due})`;const b=document.createElement('button');b.className='icon danger';b.textContent='üóë';b.onclick=()=>{if(confirm('Excluir cart√£o?')){cards=cards.filter(x=>x.name!==c.name);save('cards',cards);refreshMet();listCards();render()}};li.appendChild(b);ul.appendChild(li)})}const makeLine=t=>{const d=document.createElement('div');d.className='ol';d.innerHTML=`<div class='ot'><span>${t.desc}</span><span class='value'>${curr(t.val)}</span></div><button class='icon'>‚úèÔ∏è</button><button class='icon danger'>üóë</button>`;d.children[1].onclick=()=>editTx(t.id);d.children[2].onclick=()=>delTx(t.id);return d};function addCard(){const n=$('cName').value.trim(),cl=+$('cClose').value,du=+$('cDue').value;if(!n||cl<1||cl>31||du<1||du>31||cl>=du||cards.some(c=>c.name===n)){alert('Dados inv√°lidos');return;}cards.push({name:n,close:cl,due:du});save('cards',cards);refreshMet();listCards();$('cName').value='';$('cClose').value='';$('cDue').value=''}function addTx(){const d=$('desc').value.trim(),v=parseFloat($('val').value||0),m=$('met').value,iso=$('date').value;if(!d||!iso){alert('Complete os campos');return;}tx.push({id:Date.now(),desc:d,val:v,method:m,opDate:iso,postDate:pd(iso,m),ts:new Date().toISOString()});save('tx',tx);$('desc').value='';$('val').value='';$('date').value=new Date().toISOString().slice(0,10);render()}const delTx=id=>{if(!confirm('Apagar?'))return;tx=tx.filter(t=>t.id!==id);save('tx',tx);render()},editTx=id=>{const t=tx.find(x=>x.id===id);if(!t)return;const nd=prompt('Descri√ß√£o',t.desc);if(nd===null)return;const nv=parseFloat(prompt('Valor',t.val));if(isNaN(nv))return;t.desc=nd;t.val=nv;save('tx',tx);render()};function render(){tb.innerHTML='';const y=new Date().getFullYear(),cur=new Date().getMonth();let saldo=start||0;for(let m=0;m<12;m++){const h=document.createElement('tr');h.className='mh';if(m<cur)h.classList.add('closed');h.innerHTML=`<td colSpan=4>${mes[m]}</td>`;h.onclick=()=>{const hide=h.classList.toggle('closed');document.querySelectorAll(`tr[data-m="${m}"]`).forEach(r=>r.style.display=hide?'none':'table-row')};tb.appendChild(h);for(let d=1;d<=31;d++){const dt=new Date(y,m,d);if(dt.getMonth()!==m)break;const iso=dt.toISOString().slice(0,10),day=tx.filter(t=>t.postDate===iso),sum=day.reduce((s,t)=>s+t.val,0);saldo+=sum;const tr=document.createElement('tr');tr.dataset.m=m;tr.style.display=m<cur?'none':'table-row';tr.innerHTML=`<td>${fmt(dt)}</td><td></td><td></td><td${saldo<0?' class="balneg"':''}>${curr(saldo)}</td>`;const tD=tr.children[1],tS=tr.children[2];if(sum){tS.textContent=curr(sum);tS.className=sum<0?'neg':'pos'}day.filter(t=>t.method==='dinheiro').forEach(t=>tD.appendChild(makeLine(t)));const g={};day.filter(t=>t.method!=='dinheiro').forEach(t=>(g[t.method]=g[t.method]||[]).push(t));Object.keys(g).forEach(card=>{const det=document.createElement('details');det.className='invoice';det.innerHTML=`<summary>Fatura ${card}</summary>`;g[card].forEach(t=>{det.appendChild(makeLine(t));det.insertAdjacentHTML('beforeend',`<div class='op-ts'>${t.ts.slice(5,16).replace('T',' ')}</div>`)});tD.appendChild(det)});tb.appendChild(tr)}}}function toggleStart(){ $('sGroup').style.display=start===null?'flex':'none'}$('cAdd').onclick=addCard;$('add').onclick=addTx;$('sOk').onclick=()=>{const v=parseFloat($('sInput').value);if(isNaN(v)){alert('Valor inv√°lido');return;}start=v;save('startBal',v);toggleStart();render()};$('reset').onclick=()=>{if(!confirm('Zerar tudo?'))return;cards=[{name:'dinheiro',close:0,due:0}];tx=[];start=null;save('cards',cards);save('tx',tx);save('startBal',null);refreshMet();listCards();toggleStart();render()};(async()=>{cards=await load('cards',cards);if(!cards.some(c=>c.name==='dinheiro'))cards.unshift({name:'dinheiro',close:0,due:0});tx=await load('tx',[]);start=await load('startBal',null);refreshMet();listCards();toggleStart();$('date').value=new Date().toISOString().slice(0,10);render()})();</script></body></html>
